<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-face-aframe.prod.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            background-color: #000;
        }
        
        #toggleButton {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        #toggleButton:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        #toggleButton:active {
            transform: translateX(-50%) scale(0.95);
        }
        
        #currentModelName {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            min-width: 180px;
            transition: all 0.3s ease;
        }
        
        .model-indicator {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 4px 12px;
            border-radius: 12px;
        }
        
        .debug-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 9999;
            background-color: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            max-height: 200px;
            overflow: auto;
            border: 1px solid #0f0;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ -->
    <div id="debugPanel" class="debug-panel">
        <strong>–û—Ç–ª–∞–¥–∫–∞ –º–æ–¥–µ–ª–µ–π:</strong><br>
        <div id="debugInfo"></div>
    </div>
    
    <a-scene mindar-face embedded color-space="sRGB" 
             renderer="colorManagement: true, physicallyCorrectLights"
             vr-mode-ui="enabled: false"
             device-orientation-permission-ui="enabled: false">
        
        <!-- –¢–û–õ–¨–ö–û –û–î–ù–ê –ú–û–î–ï–õ–¨ –í a-assets –¥–ª—è –Ω–∞—á–∞–ª–∞ -->
        <a-assets>
            <!-- –°–Ω–∞—á–∞–ª–∞ —Ç–æ–ª—å–∫–æ –°–∞–Ω—Ç–∞, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å -->
            <a-asset-item id="santaClaus" src="./SantaClaus.glb"></a-asset-item>
            <a-asset-item id="headModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/sparkar/headOccluder.glb"></a-asset-item>            
        </a-assets>
        
        <a-camera active="false" position="0 0 0"></a-camera>
        
        <!-- –û–∫–ª—é–¥–µ—Ä -->
        <a-entity mindar-face-target="anchorIndex: 168">
            <a-gltf-model mindar-face-occluder 
                         position="0 0 0" 
                         rotation="0 0 0" 
                         scale="1 1 1" 
                         src="#headModel"
                         visible="false">
            </a-gltf-model>
        </a-entity>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –º–∞—Å–∫–∏ -->
        <a-entity mindar-face-target="anchorIndex: 168">
            <a-gltf-model id="maskModel" 
                         rotation="0 0 0" 
                         position="0 0 0" 
                         scale="1 1 1" 
                         src="#santaClaus">
            </a-gltf-model>
        </a-entity>
    </a-scene>
    
    <div id="currentModelName">üéÖ –°–∞–Ω—Ç–∞ –ö–ª–∞—É—Å</div>
    <div class="model-indicator">–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–µ–π...</div>
    <button id="toggleButton" style="display: none;">üîÑ –°–º–µ–Ω–∏—Ç—å –º–∞—Å–∫—É</button>
    
    <script>
        let models = [
            { 
                id: 'santaClaus', 
                name: 'üéÖ –°–∞–Ω—Ç–∞ –ö–ª–∞—É—Å',
                scale: { x: 1, y: 1, z: 1 }
            }
        ];
        
        let currentModelIndex = 0;
        const maskElement = document.getElementById('maskModel');
        const modelNameElement = document.getElementById('currentModelName');
        const toggleButton = document.getElementById('toggleButton');
        const debugInfo = document.getElementById('debugInfo');
        const modelIndicator = document.querySelector('.model-indicator');
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
        function checkFileExists(url, callback) {
            const xhr = new XMLHttpRequest();
            xhr.open('HEAD', url);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    callback(xhr.status === 200, url, xhr.status);
                }
            };
            xhr.send();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function addDebugInfo(message, isError = false) {
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            const color = isError ? '#ff5555' : '#55ff55';
            debugInfo.innerHTML = `<span style="color:${color}">[${time}] ${message}</span><br>` + debugInfo.innerHTML;
            console.log(message);
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –º–æ–¥–µ–ª–µ–π
        function checkModels() {
            addDebugInfo('–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –º–æ–¥–µ–ª–µ–π...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –°–∞–Ω—Ç—É (–¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å)
            checkFileExists('./SantaClaus.glb', function(exists, url, status) {
                if (exists) {
                    addDebugInfo(`‚úì SantaClaus.glb –Ω–∞–π–¥–µ–Ω (—Å—Ç–∞—Ç—É—Å: ${status})`);
                } else {
                    addDebugInfo(`‚úó SantaClaus.glb –ù–ï –Ω–∞–π–¥–µ–Ω (—Å—Ç–∞—Ç—É—Å: ${status})`, true);
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –û–ª–µ–Ω—è
            checkFileExists('./Reindeer.glb', function(exists, url, status) {
                if (exists) {
                    addDebugInfo(`‚úì Reindeer.glb –Ω–∞–π–¥–µ–Ω (—Å—Ç–∞—Ç—É—Å: ${status})`);
                    
                    // –ï—Å–ª–∏ –æ–ª–µ–Ω—å –Ω–∞–π–¥–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –º–æ–¥–µ–ª—å –≤ assets –∏ –≤ —Å–ø–∏—Å–æ–∫
                    addReindeerModel();
                } else {
                    addDebugInfo(`‚úó Reindeer.glb –ù–ï –Ω–∞–π–¥–µ–Ω (—Å—Ç–∞—Ç—É—Å: ${status})`, true);
                    addDebugInfo('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª Reindeer.glb –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ –∏ SantaClaus.glb', true);
                }
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –æ–ª–µ–Ω—è
        function addReindeerModel() {
            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–µ–ª—å –æ–ª–µ–Ω—è –≤ assets –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
            const sceneEl = document.querySelector('a-scene');
            const assetEl = sceneEl.querySelector('a-assets');
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –º–æ–¥–µ–ª–∏ –æ–ª–µ–Ω—è
            const reindeerAsset = document.createElement('a-asset-item');
            reindeerAsset.setAttribute('id', 'reindeer');
            reindeerAsset.setAttribute('src', './Reindeer.glb');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
            reindeerAsset.addEventListener('loaded', function() {
                addDebugInfo('–ú–æ–¥–µ–ª—å Reindeer.glb —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ –ø–∞–º—è—Ç—å');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–ª–µ–Ω—è –≤ —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
                models.push({
                    id: 'reindeer',
                    name: 'ü¶å –û–ª–µ–Ω—å –°–∞–Ω—Ç—ã',
                    scale: { x: 1, y: 1, z: 1 }
                });
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
                toggleButton.style.display = 'block';
                modelIndicator.textContent = '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –ø—Ä–æ–±–µ–ª –¥–ª—è —Å–º–µ–Ω—ã';
                addDebugInfo('–ú–æ–¥–µ–ª—å –æ–ª–µ–Ω—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ø–∏—Å–æ–∫. –í—Å–µ–≥–æ –º–æ–¥–µ–ª–µ–π: ' + models.length);
            });
            
            reindeerAsset.addEventListener('error', function(e) {
                addDebugInfo('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Reindeer.glb –≤ A-Frame', true);
                addDebugInfo('–í–æ–∑–º–æ–∂–Ω–æ, —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏–ª–∏ –Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ GLB', true);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ assets
            assetEl.appendChild(reindeerAsset);
        }
        
        // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –º–æ–¥–µ–ª–∏
        function changeModel() {
            if (models.length <= 1) {
                addDebugInfo('–î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å', true);
                return;
            }
            
            // –ú–µ–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å
            currentModelIndex = (currentModelIndex + 1) % models.length;
            const currentModel = models[currentModelIndex];
            
            addDebugInfo(`–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –º–æ–¥–µ–ª—å: ${currentModel.name}`);
            
            // –ü—Ä—è—á–µ–º —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å
            maskElement.setAttribute('visible', 'false');
            
            setTimeout(() => {
                // –ú–µ–Ω—è–µ–º –º–æ–¥–µ–ª—å
                maskElement.setAttribute('src', `#${currentModel.id}`);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Å—à—Ç–∞–±
                maskElement.setAttribute('scale', 
                    `${currentModel.scale.x} ${currentModel.scale.y} ${currentModel.scale.z}`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–µ–ª—å
                maskElement.setAttribute('visible', 'true');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
                modelNameElement.textContent = currentModel.name;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
                modelNameElement.style.transform = 'translateX(-50%) scale(1.1)';
                modelNameElement.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                
                setTimeout(() => {
                    modelNameElement.style.transform = 'translateX(-50%) scale(1)';
                }, 200);
                
                setTimeout(() => {
                    modelNameElement.style.background = 'rgba(0, 0, 0, 0.8)';
                }, 1000);
                
            }, 200);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.querySelector('a-scene').addEventListener('loaded', function() {
            addDebugInfo('AR —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(checkModels, 1000);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        toggleButton.addEventListener('click', changeModel);
        
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space') {
                event.preventDefault();
                changeModel();
            }
        });
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –º–æ–¥–µ–ª–∏ –°–∞–Ω—Ç—ã
        const santaAsset = document.querySelector('a-asset-item[id="santaClaus"]');
        if (santaAsset) {
            santaAsset.addEventListener('loaded', function() {
                addDebugInfo('–ú–æ–¥–µ–ª—å SantaClaus.glb –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
            });
            
            santaAsset.addEventListener('error', function(e) {
                addDebugInfo('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ SantaClaus.glb', true);
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
        maskElement.addEventListener('error', function(event) {
            const currentModel = models[currentModelIndex] || { name: '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è' };
            addDebugInfo(`–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–µ–ª–∏: ${currentModel.name}`, true);
            addDebugInfo('–î–µ—Ç–∞–ª–∏: ' + JSON.stringify(event.detail), true);
            
            // –ü—Ä–æ–±—É–µ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–µ—Ä–≤–æ–π –º–æ–¥–µ–ª–∏
            if (currentModelIndex !== 0 && models.length > 0) {
                setTimeout(() => {
                    currentModelIndex = 0;
                    maskElement.setAttribute('src', `#${models[0].id}`);
                    modelNameElement.textContent = models[0].name;
                    addDebugInfo('–í–æ–∑–≤—Ä–∞—Ç –∫ –º–æ–¥–µ–ª–∏ –°–∞–Ω—Ç—ã');
                }, 1000);
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ –∫–æ–Ω—Å–æ–ª–∏, —á—Ç–æ —Ñ–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã
        console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ –º–æ–¥–µ–ª–µ–π:');
        console.log('SantaClaus.glb –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ –ø—É—Ç–∏:', window.location.origin + '/SantaClaus.glb');
        console.log('Reindeer.glb –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ –ø—É—Ç–∏:', window.location.origin + '/Reindeer.glb');
        
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –æ–ª–µ–Ω—è —á–µ—Ä–µ–∑ fetch –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        fetch('./Reindeer.glb')
            .then(response => {
                console.log('–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è Reindeer.glb:', {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok,
                    headers: Object.fromEntries([...response.headers])
                });
                
                if (response.ok) {
                    return response.blob();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .then(blob => {
                console.log('Reindeer.glb –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ –∫–∞–∫ blob, —Ä–∞–∑–º–µ—Ä:', blob.size, '–±–∞–π—Ç');
                console.log('–¢–∏–ø —Ñ–∞–π–ª–∞:', blob.type);
                addDebugInfo(`Reindeer.glb –Ω–∞–π–¥–µ–Ω (${Math.round(blob.size/1024)} KB, ${blob.type})`);
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Reindeer.glb:', error);
                addDebugInfo(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Reindeer.glb: ${error.message}`, true);
            });
    </script>
</body>
</html>